<div id="banner">
  {%- assign page_paths = site.pages | map: "path" -%}
  <div class="downloads">
    {%- for path in page_paths -%}
      {%- assign my_page = site.pages | where: "path", path | first -%}
      {%- if my_page.title -%}
        <span style="padding: 0px 5px;"><a href="{{ my_page.url | relative_url }}">{{ my_page.title | escape }}</a></span>
      {%- endif -%}
    {%- endfor -%}
  </div>
  {%- if page.layout == "post_with_script_changer" -%}
  <div style="line-height: 52px; padding: 0px 5px; text-transform: uppercase;">
    Preferred scripts for Tamil text:
    <form style="display: inline;">
        <select id="select-xlit-ta">
            <option value="knda">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
            <option value="latn">Latin</option>
            <option value="mlym">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
            <option value="taml" selected>‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
            <option value="telu">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
        </select>
    </form>
    , Sanskrit text:
    <form style="display: inline;">
        <select id="select-xlit-sa">
            <option value="deva">‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä</option>
            <option value="gran" selected>ëåóëççëå∞ëå®ëççëå•ëå≤ëåøëå™ëåøëåÉ</option>
            <option value="latn">Latin</option>
        </select>
    </form>
    , and numbers:
    <form style="display: inline;">
        <select id="select-xlit-num">
            <option value="deva">‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä</option>
            <option value="knda">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
            <option value="latn">Hindu‚ÄêArabic</option>
            <option value="mlym">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
            <option value="taml" selected>‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
            <option value="telu">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
        </select>
    </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script type="text/javascript" data-lang="en">
        'use strict';
        let onSelectValueChange = function (selectId, eventHandler) {
            let previous;
            $(selectId).on('focus', function () {
                previous = this.value;
            }).change(function() {
                eventHandler(previous, this.value);
                previous = this.value;
            });
        };

        onSelectValueChange('#select-xlit-ta', xliterate.bind(undefined, "ta"));
        onSelectValueChange('#select-xlit-sa', xliterate.bind(undefined, "sa"));
        onSelectValueChange('#select-xlit-num', xliterate.bind(undefined, "num"));

        function xliterate(langCode, srcScript, dstScript) {
            if (dstScript == "latn") {
                latnXliterate(langCode, srcScript, brahmiyaToLatn);
                return;
            }
            if (srcScript == "latn") {
                latnXliterate(langCode, dstScript, latnToBrahmiya);
                return;
            }

            latnXliterate(langCode, srcScript, brahmiyaToLatn);
            latnXliterate(langCode, dstScript, latnToBrahmiya);
        }

        function latnXliterate(langCode, otherScript, converter) {
            let xlitNumbers = langCode == "num";
            let langMatched = (document.documentElement.lang == langCode) || xlitNumbers;

            let title = $("[data-id=page-title]")[0];
            if (langMatched) {
                title.textContent = converter(otherScript, title.textContent, xlitNumbers);
            }

            let content = $("[data-id=page-content]")[0];
            let walk = function(node, langMatched) {
                if (node.nodeType == Node.TEXT_NODE && langMatched) {
                    node.textContent = converter(otherScript, node.textContent, xlitNumbers);
                    return;
                }
                if ((node.nodeType == Node.ELEMENT_NODE) && ! xlitNumbers) {
                    let lang = node.dataset["lang"];
                    if (lang) {
                        langMatched = (lang == langCode);
                    }
                }
                node = node.firstChild;
                while (node) {
                    walk(node, langMatched);
                    node = node.nextSibling;
                }
            };
            walk(content, langMatched);
            walk($("nav")[0], langMatched);
        }
    </script>

    <script type="text/javascript" src="/assets/js/script_changer.js"></script>

    {%- endif -%}
</div>
